---
const benefits = [
  {
    title: 'Enhance Your Curriculum',
    description: 'Supplement academic programs with industry-relevant, hands-on courses your students actually need.',
  },
  {
    title: 'Student Career Readiness',
    description: 'Give graduates real-world skills that employers demand, bridging the gap between campus and career.',
  },
  {
    title: 'Expert Instructors',
    description: 'Access to industry practitioners who bring current, practical experience not just theory.',
  },
  {
    title: 'Seamless Integration',
    description: 'Works alongside your existing LMS and academic timetables with minimal disruption.',
  },
];

const departments = ['Engineering', 'Business', 'Arts & Design', 'Sciences', 'Social Sciences', 'Other'];

const roles = ['Dean / Head of Department', 'Faculty Member', 'Program Coordinator', 'Student Affairs', 'Other'];

const studentCounts = ['Under 100', '100-500', '500-1,000', '1,000+'];

const startOptions = ['Next semester', '3-6 months', 'Next academic year', 'Just exploring'];

const countryCodes = [
  { code: '+234', label: 'NG +234' },
  { code: '+1', label: 'US +1' },
  { code: '+44', label: 'UK +44' },
  { code: '+91', label: 'IN +91' },
  { code: '+254', label: 'KE +254' },
  { code: '+233', label: 'GH +233' },
  { code: '+27', label: 'ZA +27' },
  { code: '+971', label: 'AE +971' },
  { code: '+61', label: 'AU +61' },
  { code: '+49', label: 'DE +49' },
];
---

<section id="universities" class="bg-[#FBF8F1] py-20 md:py-28">
  <!-- Hero Header -->
  <div class="max-w-3xl mx-auto text-center px-6 mb-16 md:mb-20">
    <h2 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-[#1A0533] leading-tight">
      Partner With Us
      <br />
      <em class="font-['Playfair_Display',serif] font-bold">For Your Students</em>
    </h2>
    <p class="mt-5 text-gray-500 text-base md:text-lg leading-relaxed">
      Bring industry-grade, live cohort courses to your campus. Give students
      the skills they need to thrive, before they even graduate.
    </p>
  </div>

  <!-- Two-column content -->
  <div class="max-w-7xl mx-auto px-6 md:px-12 lg:px-16 xl:px-24 grid grid-cols-1 lg:grid-cols-5 gap-12 lg:gap-16 items-start">

    <!-- Left column: Why Partner with Us -->
    <div class="lg:col-span-2">
      <h3 class="text-3xl md:text-4xl font-extrabold text-[#1A0533] leading-snug">
        Why Partner
        <br />
        <em class="font-['Playfair_Display',serif] font-bold">with Us?</em>
      </h3>

      <div class="mt-8 space-y-6">
        {benefits.map((benefit) => (
          <div>
            <h4 class="text-base font-bold text-[#1A0533] mb-1">{benefit.title}</h4>
            <p class="text-sm text-gray-500 leading-relaxed">{benefit.description}</p>
          </div>
        ))}
      </div>
    </div>

    <!-- Right column: Form Card -->
    <div class="lg:col-span-3">
      <!-- Success message (hidden by default) -->
      <div id="uni-success" class="hidden bg-white rounded-3xl shadow-xl p-8 md:p-10 text-center">
        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <svg class="w-8 h-8 text-green-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 6L9 17l-5-5" />
          </svg>
        </div>
        <h3 class="text-2xl font-bold text-[#1A0533] mb-3">Partnership Request Sent!</h3>
        <p class="text-gray-500 text-base leading-relaxed max-w-md mx-auto">
          Thanks for reaching out! Our university partnerships team will be in touch within 3-5 business days.
        </p>
      </div>

      <!-- Form card -->
      <div id="uni-form-card" class="bg-white rounded-3xl shadow-xl p-8 md:p-10">
        <form
          id="uni-form"
          name="for-universities"
          method="POST"
          data-netlify="true"
          netlify-honeypot="bot-field"
          novalidate
          class="space-y-6"
        >
          <p class="hidden">
            <label>Don&#8217;t fill this out: <input name="bot-field" type="text" /></label>
          </p>
          <input type="hidden" name="form-name" value="for-universities" />

          <!-- University / Institution Name -->
          <div>
            <label for="uni-institution" class="block text-sm font-semibold text-[#1A0533] mb-2">University / Institution Name</label>
            <input
              type="text"
              id="uni-institution"
              name="institution-name"
              placeholder="Enter your university or institution name"
              required
              class="w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] focus:border-[#D4A853] transition-all duration-200"
            />
          </div>

          <!-- Your Full Name -->
          <div>
            <label for="uni-name" class="block text-sm font-semibold text-[#1A0533] mb-2">Your Full Name</label>
            <input
              type="text"
              id="uni-name"
              name="full-name"
              placeholder="Enter your full name"
              required
              class="w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] focus:border-[#D4A853] transition-all duration-200"
            />
          </div>

          <!-- Work Email -->
          <div>
            <label for="uni-email" class="block text-sm font-semibold text-[#1A0533] mb-2">Work Email</label>
            <input
              type="email"
              id="uni-email"
              name="email"
              placeholder="Enter your institutional email"
              required
              class="w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] focus:border-[#D4A853] transition-all duration-200"
            />
            <p id="uni-email-error" class="text-red-500 text-xs mt-1 hidden">Please enter a valid email address.</p>
          </div>

          <!-- WhatsApp Number with country code -->
          <div>
            <label for="uni-whatsapp" class="block text-sm font-semibold text-[#1A0533] mb-2">WhatsApp Number</label>
            <div class="flex gap-2">
              <select
                name="country-code"
                id="uni-country-code"
                class="bg-gray-50 rounded-xl px-3 py-3 text-sm text-gray-800 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] transition-all duration-200 shrink-0 w-28"
              >
                {countryCodes.map((cc) => (
                  <option value={cc.code}>{cc.label}</option>
                ))}
              </select>
              <input
                type="tel"
                id="uni-whatsapp"
                name="whatsapp"
                placeholder="Phone number"
                required
                class="w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] focus:border-[#D4A853] transition-all duration-200"
              />
            </div>
          </div>

          <!-- Your Role -->
          <div>
            <label for="uni-role" class="block text-sm font-semibold text-[#1A0533] mb-2">Your Role</label>
            <select
              id="uni-role"
              name="role"
              required
              class="w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] transition-all duration-200 cursor-pointer"
            >
              <option value="" disabled selected>Select your role</option>
              {roles.map((role) => (
                <option value={role}>{role}</option>
              ))}
            </select>
          </div>

          <!-- Departments interested (Multi-select dropdown) -->
          <div>
            <label class="block text-sm font-semibold text-[#1A0533] mb-2">Departments interested</label>
            <input type="hidden" name="departments" id="uni-depts-hidden" />
            <div class="relative">
              <button
                type="button"
                id="uni-depts-toggle"
                class="w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-left border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] transition-all duration-200 flex items-center justify-between cursor-pointer"
              >
                <span id="uni-depts-label" class="text-gray-400">Select departments</span>
                <svg class="w-4 h-4 text-gray-400 shrink-0 transition-transform duration-200" id="uni-depts-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </button>
              <div id="uni-depts-menu" class="hidden absolute z-20 top-full left-0 right-0 mt-1 bg-white rounded-xl shadow-lg border border-gray-100 p-3 space-y-2">
                {departments.map((dept) => (
                  <label class="flex items-center gap-3 px-2 py-1.5 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                    <input type="checkbox" value={dept} class="uni-dept-checkbox w-4 h-4 rounded border-gray-300 text-[#D4A853] focus:ring-[#D4A853]" />
                    <span class="text-sm text-gray-700">{dept}</span>
                  </label>
                ))}
              </div>
            </div>
          </div>

          <!-- Estimated number of students -->
          <div>
            <label for="uni-students" class="block text-sm font-semibold text-[#1A0533] mb-2">Estimated number of students</label>
            <select
              id="uni-students"
              name="student-count"
              required
              class="w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] transition-all duration-200 cursor-pointer"
            >
              <option value="" disabled selected>Select an estimate</option>
              {studentCounts.map((count) => (
                <option value={count}>{count} students</option>
              ))}
            </select>
          </div>

          <!-- When would you like to start? -->
          <div>
            <label for="uni-start" class="block text-sm font-semibold text-[#1A0533] mb-2">When would you like to start?</label>
            <select
              id="uni-start"
              name="start-timeline"
              required
              class="w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] transition-all duration-200 cursor-pointer"
            >
              <option value="" disabled selected>Select a timeline</option>
              {startOptions.map((opt) => (
                <option value={opt}>{opt}</option>
              ))}
            </select>
          </div>

          <!-- Tell us about your goals (optional) -->
          <div>
            <label for="uni-goals" class="block text-sm font-semibold text-[#1A0533] mb-2">
              Tell us about your goals <span class="font-normal text-gray-400">(optional)</span>
            </label>
            <textarea
              id="uni-goals"
              name="goals"
              placeholder="What outcomes are you hoping to achieve? Any specific departments, programs, or challenges..."
              rows="3"
              class="w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] focus:border-[#D4A853] transition-all duration-200 resize-y"
            ></textarea>
          </div>

          <!-- Submit button -->
          <button
            type="submit"
            id="uni-submit-btn"
            class="w-full bg-[#BB39B4] hover:bg-[#BB39B4] text-white font-bold text-base rounded-full py-3.5 transition-colors duration-200 cursor-pointer"
          >
            Request Partnership
          </button>
        </form>
      </div>
    </div>

  </div>
</section>

<script>
  declare global {
    interface Window {
      posthog?: any;
    }
  }

  function initUniForm() {
    const form = document.getElementById('uni-form') as HTMLFormElement | null;
    const formCard = document.getElementById('uni-form-card')!;
    const successMessage = document.getElementById('uni-success')!;
    if (!form) return;

    // --- Multi-select dropdown ---
    const deptsToggle = document.getElementById('uni-depts-toggle')!;
    const deptsMenu = document.getElementById('uni-depts-menu')!;
    const deptsLabel = document.getElementById('uni-depts-label')!;
    const deptsChevron = document.getElementById('uni-depts-chevron')!;
    const deptsHidden = document.getElementById('uni-depts-hidden') as HTMLInputElement;
    const deptCheckboxes = deptsMenu.querySelectorAll<HTMLInputElement>('.uni-dept-checkbox');

    deptsToggle.addEventListener('click', () => {
      const isOpen = !deptsMenu.classList.contains('hidden');
      deptsMenu.classList.toggle('hidden');
      deptsChevron.classList.toggle('rotate-180', !isOpen);
    });

    document.addEventListener('click', (e) => {
      if (!deptsToggle.contains(e.target as Node) && !deptsMenu.contains(e.target as Node)) {
        deptsMenu.classList.add('hidden');
        deptsChevron.classList.remove('rotate-180');
      }
    });

    function updateDeptsLabel() {
      const selected = [...deptCheckboxes].filter((c) => c.checked).map((c) => c.value);
      deptsHidden.value = selected.join(', ');
      if (selected.length > 0) {
        deptsLabel.textContent = selected.join(', ');
        deptsLabel.classList.remove('text-gray-400');
        deptsLabel.classList.add('text-gray-800');
      } else {
        deptsLabel.textContent = 'Select departments';
        deptsLabel.classList.add('text-gray-400');
        deptsLabel.classList.remove('text-gray-800');
      }
    }

    deptCheckboxes.forEach((cb) => cb.addEventListener('change', updateDeptsLabel));

    // --- Validation ---
    const emailInput = form.querySelector('#uni-email') as HTMLInputElement;
    const emailError = document.getElementById('uni-email-error')!;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    function validateEmail(): boolean {
      const valid = emailRegex.test(emailInput.value.trim());
      emailError.classList.toggle('hidden', valid || emailInput.value.trim() === '');
      return valid;
    }

    emailInput.addEventListener('blur', validateEmail);

    // --- Form submission ---
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!validateEmail()) {
        emailInput.focus();
        return;
      }

      const submitBtn = document.getElementById('uni-submit-btn') as HTMLButtonElement;
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';

      const formData = new FormData(form);

      try {
        await fetch('/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams(formData as any).toString(),
        });

        // Track successful university partnership request in PostHog
        const role = (document.getElementById('uni-role') as HTMLSelectElement)?.value || '';
        const departments = (document.getElementById('uni-depts-hidden') as HTMLInputElement)?.value || '';
        const studentCount = (document.getElementById('uni-students') as HTMLSelectElement)?.value || '';
        const startTimeline = (document.getElementById('uni-start') as HTMLSelectElement)?.value || '';
        window.posthog?.capture('university_partnership_requested', {
          form_name: 'for-universities',
          role: role,
          departments: departments,
          student_count: studentCount,
          start_timeline: startTimeline
        });

        formCard.classList.add('hidden');
        successMessage.classList.remove('hidden');
      } catch (err) {
        // Capture form submission error in PostHog
        window.posthog?.captureException(err);
        submitBtn.disabled = false;
        submitBtn.textContent = 'Request Partnership';
        alert('Something went wrong. Please try again.');
      }
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initUniForm);
  } else {
    initUniForm();
  }
</script>
