---
const benefits = [
  {
    title: 'Reach Hungry Learners',
    description: 'Teach motivated students in live cohorts of 20-30 who actually show up and complete the course.',
  },
  {
    title: 'We Handle the Rest',
    description: 'Marketing, payments, platform, and student support, you just focus on teaching.',
  },
  {
    title: 'Earn While You Teach',
    description: 'Competitive revenue share on every cohort. The more you teach, the more you earn.',
  },
  {
    title: 'Build Your Brand',
    description: "Grow your personal brand and audience while making a real impact on students' careers.",
  },
];

const teachingSubjects = ['Design', 'Development', 'Business', 'Creative', 'Other'];

const startOptions = ['Immediately', '1-3 months', '3-6 months', 'Just exploring'];

const countryCodes = [
  { code: '+234', label: 'NG +234' },
  { code: '+1', label: 'US +1' },
  { code: '+44', label: 'UK +44' },
  { code: '+91', label: 'IN +91' },
  { code: '+254', label: 'KE +254' },
  { code: '+233', label: 'GH +233' },
  { code: '+27', label: 'ZA +27' },
  { code: '+971', label: 'AE +971' },
  { code: '+61', label: 'AU +61' },
  { code: '+49', label: 'DE +49' },
];
---

<section id="teach" class="bg-[#FBF8F1] py-20 md:py-28">
  <!-- Hero Header -->
  <div class="max-w-3xl mx-auto text-center px-6 mb-16 md:mb-20">
    <h2 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-[#1A0533] leading-tight">
      Let's Talk
      <br />
      <em class="font-['Playfair_Display',serif] font-bold">We'll Be In Touch</em>
    </h2>
    <p class="mt-5 text-gray-500 text-base md:text-lg leading-relaxed">
      Share your expertise with thousands of motivated learners. We provide the
      platform, marketing, and support, you bring the knowledge.
    </p>
  </div>

  <!-- Two-column content -->
  <div class="max-w-7xl mx-auto px-6 md:px-12 lg:px-16 xl:px-24 grid grid-cols-1 lg:grid-cols-5 gap-12 lg:gap-16 items-start">

    <!-- Left column: Why Teach with Us -->
    <div class="lg:col-span-2">
      <h3 class="text-3xl md:text-4xl font-extrabold text-[#1A0533] leading-snug">
        Why Teach
        <br />
        <em class="font-['Playfair_Display',serif] font-bold">with Us?</em>
      </h3>

      <div class="mt-8 space-y-6">
        {benefits.map((benefit) => (
          <div>
            <h4 class="text-base font-bold text-[#1A0533] mb-1">{benefit.title}</h4>
            <p class="text-sm text-gray-500 leading-relaxed">{benefit.description}</p>
          </div>
        ))}
      </div>
    </div>

    <!-- Right column: Form Card -->
    <div class="lg:col-span-3">
      <!-- Success message (hidden by default) -->
      <div id="apply-success" class="hidden bg-white rounded-3xl shadow-xl p-8 md:p-10 text-center">
        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <svg class="w-8 h-8 text-green-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 6L9 17l-5-5" />
          </svg>
        </div>
        <h3 class="text-2xl font-bold text-[#1A0533] mb-3">Application Submitted!</h3>
        <p class="text-gray-500 text-base leading-relaxed max-w-md mx-auto">
          Thanks! We'll review your application and get back to you within 3-5 business days.
        </p>
      </div>

      <!-- Form card -->
      <div id="apply-form-card" class="bg-white rounded-3xl shadow-xl p-8 md:p-10">
        <form
          id="apply-form"
          name="apply-to-teach"
          method="POST"
          data-netlify="true"
          netlify-honeypot="bot-field"
          novalidate
          class="space-y-6"
        >
          <p class="hidden">
            <label>Don&#8217;t fill this out: <input name="bot-field" type="text" /></label>
          </p>
          <input type="hidden" name="form-name" value="apply-to-teach" />

          <!-- Full Name -->
          <div>
            <label for="apply-name" class="block text-sm font-semibold text-[#1A0533] mb-2">Full Name</label>
            <input
              type="text"
              id="apply-name"
              name="full-name"
              placeholder="Enter your full name"
              required
              class="apply-input w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] focus:border-[#D4A853] transition-all duration-200"
            />
          </div>

          <!-- Email -->
          <div>
            <label for="apply-email" class="block text-sm font-semibold text-[#1A0533] mb-2">Email</label>
            <input
              type="email"
              id="apply-email"
              name="email"
              placeholder="Enter your email"
              required
              class="apply-input w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] focus:border-[#D4A853] transition-all duration-200"
            />
            <p id="apply-email-error" class="text-red-500 text-xs mt-1 hidden">Please enter a valid email address.</p>
          </div>

          <!-- WhatsApp Number with country code -->
          <div>
            <label for="apply-whatsapp" class="block text-sm font-semibold text-[#1A0533] mb-2">WhatsApp Number</label>
            <div class="flex gap-2">
              <select
                name="country-code"
                id="apply-country-code"
                class="bg-gray-50 rounded-xl px-3 py-3 text-sm text-gray-800 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] transition-all duration-200 shrink-0 w-28"
              >
                {countryCodes.map((cc) => (
                  <option value={cc.code}>{cc.label}</option>
                ))}
              </select>
              <input
                type="tel"
                id="apply-whatsapp"
                name="whatsapp"
                placeholder="Phone number"
                required
                class="apply-input w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] focus:border-[#D4A853] transition-all duration-200"
              />
            </div>
          </div>

          <!-- LinkedIn URL -->
          <div>
            <label for="apply-linkedin" class="block text-sm font-semibold text-[#1A0533] mb-2">LinkedIn URL</label>
            <input
              type="url"
              id="apply-linkedin"
              name="linkedin"
              placeholder="https://linkedin.com/in/yourprofile"
              class="apply-input w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] focus:border-[#D4A853] transition-all duration-200"
            />
          </div>

          <!-- I'm applying as (checkboxes) -->
          <fieldset>
            <legend class="block text-sm font-semibold text-[#1A0533] mb-3">I'm applying as:</legend>
            <div class="flex flex-wrap gap-4">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="applying-as" value="Course Creator" class="w-4 h-4 rounded border-gray-300 text-[#D4A853] focus:ring-[#D4A853]" />
                <span class="text-sm text-gray-700">Course Creator</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="applying-as" value="Instructor" class="w-4 h-4 rounded border-gray-300 text-[#D4A853] focus:ring-[#D4A853]" />
                <span class="text-sm text-gray-700">Instructor</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="checkbox" name="applying-as" value="Both" class="w-4 h-4 rounded border-gray-300 text-[#D4A853] focus:ring-[#D4A853]" />
                <span class="text-sm text-gray-700">Both</span>
              </label>
            </div>
          </fieldset>

          <!-- Have you created courses before? (conditional) -->
          <fieldset>
            <legend class="block text-sm font-semibold text-[#1A0533] mb-3">Have you created courses before?</legend>
            <div class="flex gap-6">
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="created-courses" value="Yes" id="courses-yes" class="w-4 h-4 border-gray-300 text-[#D4A853] focus:ring-[#D4A853]" />
                <span class="text-sm text-gray-700">Yes</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input type="radio" name="created-courses" value="No" id="courses-no" class="w-4 h-4 border-gray-300 text-[#D4A853] focus:ring-[#D4A853]" />
                <span class="text-sm text-gray-700">No</span>
              </label>
            </div>
          </fieldset>

          <!-- Conditional: Course links (shown when Yes) -->
          <div id="course-links-wrapper" class="hidden">
            <label for="apply-course-links" class="block text-sm font-semibold text-[#1A0533] mb-2">Share links to your courses</label>
            <textarea
              id="apply-course-links"
              name="course-links"
              placeholder="Paste links to your existing courses (one per line)"
              rows="3"
              class="apply-input w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] focus:border-[#D4A853] transition-all duration-200 resize-y"
            ></textarea>
          </div>

          <!-- What would you like to teach? (Multi-select dropdown) -->
          <div>
            <label class="block text-sm font-semibold text-[#1A0533] mb-2">What would you like to teach?</label>
            <input type="hidden" name="subjects" id="subjects-hidden" />
            <div class="relative">
              <button
                type="button"
                id="subjects-toggle"
                class="w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-left border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] transition-all duration-200 flex items-center justify-between cursor-pointer"
              >
                <span id="subjects-label" class="text-gray-400">Select subjects</span>
                <svg class="w-4 h-4 text-gray-400 shrink-0 transition-transform duration-200" id="subjects-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </button>
              <div id="subjects-menu" class="hidden absolute z-20 top-full left-0 right-0 mt-1 bg-white rounded-xl shadow-lg border border-gray-100 p-3 space-y-2">
                {teachingSubjects.map((subject) => (
                  <label class="flex items-center gap-3 px-2 py-1.5 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors">
                    <input type="checkbox" value={subject} class="subject-checkbox w-4 h-4 rounded border-gray-300 text-[#D4A853] focus:ring-[#D4A853]" />
                    <span class="text-sm text-gray-700">{subject}</span>
                  </label>
                ))}
              </div>
            </div>
          </div>

          <!-- When would you like to start? -->
          <div>
            <label for="apply-start" class="block text-sm font-semibold text-[#1A0533] mb-2">When would you like to start?</label>
            <select
              id="apply-start"
              name="start-timeline"
              required
              class="w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] transition-all duration-200 cursor-pointer"
            >
              <option value="" disabled selected>Select a timeline</option>
              {startOptions.map((opt) => (
                <option value={opt}>{opt}</option>
              ))}
            </select>
          </div>

          <!-- Specific topics -->
          <div>
            <label for="apply-topics" class="block text-sm font-semibold text-[#1A0533] mb-2">Specific topics you'd like to teach</label>
            <textarea
              id="apply-topics"
              name="topics"
              placeholder="e.g. ChatGPT for marketers, React for beginners, Excel for data analysis..."
              rows="3"
              required
              class="apply-input w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] focus:border-[#D4A853] transition-all duration-200 resize-y"
            ></textarea>
          </div>

          <!-- Tell us more (optional) -->
          <div>
            <label for="apply-more" class="block text-sm font-semibold text-[#1A0533] mb-2">
              Tell us more <span class="font-normal text-gray-400">(optional)</span>
            </label>
            <textarea
              id="apply-more"
              name="more-info"
              placeholder="Anything else you'd like us to know â€” your experience, teaching style, goals..."
              rows="3"
              class="apply-input w-full bg-gray-50 rounded-xl px-4 py-3 text-sm text-gray-800 placeholder-gray-400 border border-transparent focus:outline-none focus:ring-2 focus:ring-[#D4A853] focus:border-[#D4A853] transition-all duration-200 resize-y"
            ></textarea>
          </div>

          <!-- Submit button -->
          <button
            type="submit"
            id="apply-submit-btn"
            class="w-full bg-[#BB39B4] hover:bg-[#BB39B4] text-white font-bold text-base rounded-full py-3.5 transition-colors duration-200 cursor-pointer"
          >
            Submit Application
          </button>
        </form>
      </div>
    </div>

  </div>
</section>

<script>
  function initApplyForm() {
    const form = document.getElementById('apply-form') as HTMLFormElement | null;
    const formCard = document.getElementById('apply-form-card')!;
    const successMessage = document.getElementById('apply-success')!;
    if (!form) return;

    // --- Conditional: course links visibility ---
    const coursesYes = document.getElementById('courses-yes') as HTMLInputElement;
    const coursesNo = document.getElementById('courses-no') as HTMLInputElement;
    const courseLinksWrapper = document.getElementById('course-links-wrapper')!;

    coursesYes.addEventListener('change', () => {
      if (coursesYes.checked) courseLinksWrapper.classList.remove('hidden');
    });
    coursesNo.addEventListener('change', () => {
      if (coursesNo.checked) courseLinksWrapper.classList.add('hidden');
    });

    // --- Multi-select dropdown ---
    const subjectsToggle = document.getElementById('subjects-toggle')!;
    const subjectsMenu = document.getElementById('subjects-menu')!;
    const subjectsLabel = document.getElementById('subjects-label')!;
    const subjectsChevron = document.getElementById('subjects-chevron')!;
    const subjectsHidden = document.getElementById('subjects-hidden') as HTMLInputElement;
    const subjectCheckboxes = subjectsMenu.querySelectorAll<HTMLInputElement>('.subject-checkbox');

    subjectsToggle.addEventListener('click', () => {
      const isOpen = !subjectsMenu.classList.contains('hidden');
      subjectsMenu.classList.toggle('hidden');
      subjectsChevron.classList.toggle('rotate-180', !isOpen);
    });

    document.addEventListener('click', (e) => {
      if (!subjectsToggle.contains(e.target as Node) && !subjectsMenu.contains(e.target as Node)) {
        subjectsMenu.classList.add('hidden');
        subjectsChevron.classList.remove('rotate-180');
      }
    });

    function updateSubjectsLabel() {
      const selected = [...subjectCheckboxes].filter((c) => c.checked).map((c) => c.value);
      subjectsHidden.value = selected.join(', ');
      if (selected.length > 0) {
        subjectsLabel.textContent = selected.join(', ');
        subjectsLabel.classList.remove('text-gray-400');
        subjectsLabel.classList.add('text-gray-800');
      } else {
        subjectsLabel.textContent = 'Select subjects';
        subjectsLabel.classList.add('text-gray-400');
        subjectsLabel.classList.remove('text-gray-800');
      }
    }

    subjectCheckboxes.forEach((cb) => cb.addEventListener('change', updateSubjectsLabel));

    // --- Validation ---
    const emailInput = form.querySelector('#apply-email') as HTMLInputElement;
    const emailError = document.getElementById('apply-email-error')!;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    function validateEmail(): boolean {
      const valid = emailRegex.test(emailInput.value.trim());
      emailError.classList.toggle('hidden', valid || emailInput.value.trim() === '');
      return valid;
    }

    emailInput.addEventListener('blur', validateEmail);

    // --- Form submission ---
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!validateEmail()) {
        emailInput.focus();
        return;
      }

      const submitBtn = document.getElementById('apply-submit-btn') as HTMLButtonElement;
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';

      const formData = new FormData(form);

      try {
        await fetch('/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams(formData as any).toString(),
        });

        // Track successful instructor application in PostHog
        const subjects = (document.getElementById('subjects-hidden') as HTMLInputElement)?.value || '';
        const startTimeline = (document.getElementById('apply-start') as HTMLSelectElement)?.value || '';
        window.posthog?.capture('instructor_application_submitted', {
          form_name: 'apply-to-teach',
          subjects: subjects,
          start_timeline: startTimeline
        });

        formCard.classList.add('hidden');
        successMessage.classList.remove('hidden');
      } catch (err) {
        // Capture form submission error in PostHog
        window.posthog?.captureException(err);
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Application';
        alert('Something went wrong. Please try again.');
      }
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initApplyForm);
  } else {
    initApplyForm();
  }
</script>
